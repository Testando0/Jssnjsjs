<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KuromiFlix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #fff; margin: 0; font-family: sans-serif; }
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 10px; 
            padding: 10px; 
        }
        @media (min-width: 768px) { .grid-container { grid-template-columns: repeat(6, 1fr); } }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <nav class="fixed top-0 w-full z-50 bg-black/90 p-4 border-b border-white/10 flex justify-between items-center">
        <h1 class="text-red-600 text-2xl font-black" onclick="location.reload()">KUROMIFLIX</h1>
        <input id="search" type="text" placeholder="Pesquisar..." class="bg-zinc-800 rounded px-4 py-1 text-sm outline-none focus:ring-1 focus:ring-red-600">
    </nav>

    <div id="results" class="fixed top-16 left-0 w-full bg-zinc-900 z-[60] hidden overflow-y-auto max-h-[70vh]"></div>

    <main id="main" class="pt-20"></main>

    <div id="player" class="fixed inset-0 z-[100] bg-black hidden flex-col">
        <div class="p-4 bg-zinc-900 flex justify-between">
            <button onclick="closePlayer()" class="bg-red-600 px-6 py-2 rounded font-bold uppercase text-xs">Voltar</button>
        </div>
        <div id="video-area" class="flex-grow"></div>
    </div>

    <script>
        const KEY = '8265bd1679663a7ea12ac168da84d2e8';
        const searchInput = document.getElementById('search');
        const resultsDiv = document.getElementById('results');

        // BUSCA TMDB
        searchInput.oninput = async () => {
            if (searchInput.value.length < 3) { resultsDiv.classList.add('hidden'); return; }
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${KEY}&language=pt-BR&query=${searchInput.value}`);
            const data = await res.json();
            resultsDiv.classList.remove('hidden');
            resultsDiv.innerHTML = data.results.map(i => `
                <div onclick="openPlayer('${i.media_type === 'tv' ? 'tv' : 'movie'}', ${i.id})" class="p-4 border-b border-white/5 flex gap-4 cursor-pointer items-center">
                    <img src="https://image.tmdb.org/t/p/w92${i.poster_path}" class="w-10">
                    <span>${i.title || i.name}</span>
                </div>
            `).join('');
        };

        function openPlayer(type, id) {
            resultsDiv.classList.add('hidden');
            // Player limpo. Sem sandbox. Sem proxy. Do jeito que a API aceita.
            document.getElementById('video-area').innerHTML = `<iframe src="https://superflixapi.asia/${type}/${id}" allowfullscreen></iframe>`;
            document.getElementById('player').classList.remove('hidden');
            document.getElementById('player').classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closePlayer() {
            document.getElementById('video-area').innerHTML = '';
            document.getElementById('player').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        async function loadHome() {
            const res = await fetch(`https://api.themoviedb.org/3/trending/all/week?api_key=${KEY}&language=pt-BR`);
            const data = await res.json();
            document.getElementById('main').innerHTML = `<div class="grid-container">${data.results.map(i => `
                <div onclick="openPlayer('${i.media_type === 'tv' ? 'tv' : 'movie'}', ${i.id})" class="cursor-pointer">
                    <img src="https://image.tmdb.org/t/p/w500${i.poster_path}" class="rounded shadow-lg">
                    <p class="mt-1 text-[10px] truncate opacity-70">${i.title || i.name}</p>
                </div>
            `).join('')}</div>`;
        }

        loadHome();
    </script>
</body>
</html>
